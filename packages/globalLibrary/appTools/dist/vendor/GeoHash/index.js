"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.encodeGeoHash = encodeGeoHash;
// geohash.js
// Geohash library for Javascript
// (c) 2008 David Troy
// Distributed under the MIT License
var BITS = [16, 8, 4, 2, 1];
var BASE32 = '0123456789bcdefghjkmnpqrstuvwxyz';
var NEIGHBORS = {
  right: {
    even: 'bc01fg45238967deuvhjyznpkmstqrwx'
  },
  left: {
    even: '238967debc01fg45kmstqrwxuvhjyznp'
  },
  top: {
    even: 'p0r21436x8zb9dcf5h7kjnmqesgutwvy'
  },
  bottom: {
    even: '14365h7k9dcfesgujnmqp0r2twvyx8zb'
  }
};
var BORDERS = {
  right: {
    even: 'bcfguvyz'
  },
  left: {
    even: '0145hjnp'
  },
  top: {
    even: 'prxz'
  },
  bottom: {
    even: '028b'
  }
};
NEIGHBORS.bottom.odd = NEIGHBORS.left.even;
NEIGHBORS.top.odd = NEIGHBORS.right.even;
NEIGHBORS.left.odd = NEIGHBORS.bottom.even;
NEIGHBORS.right.odd = NEIGHBORS.top.even;
BORDERS.bottom.odd = BORDERS.left.even;
BORDERS.top.odd = BORDERS.right.even;
BORDERS.left.odd = BORDERS.bottom.even;
BORDERS.right.odd = BORDERS.top.even;

function refine_interval(interval, cd, mask) {
  if (cd & mask) {
    interval[0] = (interval[0] + interval[1]) / 2;
  } else {
    interval[1] = (interval[0] + interval[1]) / 2;
  }
}

function calculateAdjacent(srcHash, dir) {
  srcHash = srcHash.toLowerCase();
  var lastChr = srcHash.charAt(srcHash.length - 1);
  var type = srcHash.length % 2 ? 'odd' : 'even';
  var base = srcHash.substring(0, srcHash.length - 1);

  if (BORDERS[dir][type].indexOf(lastChr) !== -1) {
    base = calculateAdjacent(base, dir);
  }

  return base + BASE32[NEIGHBORS[dir][type].indexOf(lastChr)];
}

function decodeGeoHash(geohash) {
  var isEven = 1;
  var lat = [];
  var lon = [];
  lat[0] = -90.0;
  lat[1] = 90.0;
  lon[0] = -180.0;
  lon[1] = 180.0;
  var latErr = 90.0;
  var lonErr = 180.0;

  for (var i = 0; i < geohash.length; i++) {
    var c = geohash[i];
    var cd = BASE32.indexOf(c);

    for (var j = 0; j < 5; j++) {
      var mask = BITS[j];

      if (isEven) {
        lonErr /= 2;
        refine_interval(lon, cd, mask);
      } else {
        latErr /= 2;
        refine_interval(lat, cd, mask);
      }

      isEven = !isEven;
    }
  }

  lat[2] = (lat[0] + lat[1]) / 2;
  lon[2] = (lon[0] + lon[1]) / 2;
  return {
    latitude: lat,
    longitude: lon
  };
}

function encodeGeoHash(latitude, longitude) {
  var isEven = 1;
  var i = 0;
  var lat = [];
  var lon = [];
  var bit = 0;
  var ch = 0;
  var precision = 12;
  var geohash = '';
  lat[0] = -90.0;
  lat[1] = 90.0;
  lon[0] = -180.0;
  lon[1] = 180.0;
  var mid;

  while (geohash.length < precision) {
    if (isEven) {
      mid = (lon[0] + lon[1]) / 2;

      if (longitude > mid) {
        ch |= BITS[bit];
        lon[0] = mid;
      } else {
        lon[1] = mid;
      }
    } else {
      mid = (lat[0] + lat[1]) / 2;

      if (latitude > mid) {
        ch |= BITS[bit];
        lat[0] = mid;
      } else {
        lat[1] = mid;
      }
    }

    isEven = !isEven;

    if (bit < 4) {
      bit++;
    } else {
      geohash += BASE32[ch];
      bit = 0;
      ch = 0;
    }
  }

  return geohash;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy92ZW5kb3IvR2VvSGFzaC9pbmRleC50cyJdLCJuYW1lcyI6WyJCSVRTIiwiQkFTRTMyIiwiTkVJR0hCT1JTIiwicmlnaHQiLCJldmVuIiwibGVmdCIsInRvcCIsImJvdHRvbSIsIkJPUkRFUlMiLCJvZGQiLCJyZWZpbmVfaW50ZXJ2YWwiLCJpbnRlcnZhbCIsImNkIiwibWFzayIsImNhbGN1bGF0ZUFkamFjZW50Iiwic3JjSGFzaCIsImRpciIsInRvTG93ZXJDYXNlIiwibGFzdENociIsImNoYXJBdCIsImxlbmd0aCIsInR5cGUiLCJiYXNlIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImRlY29kZUdlb0hhc2giLCJnZW9oYXNoIiwiaXNFdmVuIiwibGF0IiwibG9uIiwibGF0RXJyIiwibG9uRXJyIiwiaSIsImMiLCJqIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJlbmNvZGVHZW9IYXNoIiwiYml0IiwiY2giLCJwcmVjaXNpb24iLCJtaWQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsSUFBTUEsSUFBSSxHQUFHLENBQUMsRUFBRCxFQUFLLENBQUwsRUFBUSxDQUFSLEVBQVcsQ0FBWCxFQUFjLENBQWQsQ0FBYjtBQUNBLElBQU1DLE1BQU0sR0FBRyxrQ0FBZjtBQUVBLElBQU1DLFNBQWMsR0FBRztBQUNyQkMsRUFBQUEsS0FBSyxFQUFFO0FBQUVDLElBQUFBLElBQUksRUFBRTtBQUFSLEdBRGM7QUFFckJDLEVBQUFBLElBQUksRUFBRTtBQUFFRCxJQUFBQSxJQUFJLEVBQUU7QUFBUixHQUZlO0FBR3JCRSxFQUFBQSxHQUFHLEVBQUU7QUFBRUYsSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FIZ0I7QUFJckJHLEVBQUFBLE1BQU0sRUFBRTtBQUFFSCxJQUFBQSxJQUFJLEVBQUU7QUFBUjtBQUphLENBQXZCO0FBTUEsSUFBTUksT0FBWSxHQUFHO0FBQ25CTCxFQUFBQSxLQUFLLEVBQUU7QUFBRUMsSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FEWTtBQUVuQkMsRUFBQUEsSUFBSSxFQUFFO0FBQUVELElBQUFBLElBQUksRUFBRTtBQUFSLEdBRmE7QUFHbkJFLEVBQUFBLEdBQUcsRUFBRTtBQUFFRixJQUFBQSxJQUFJLEVBQUU7QUFBUixHQUhjO0FBSW5CRyxFQUFBQSxNQUFNLEVBQUU7QUFBRUgsSUFBQUEsSUFBSSxFQUFFO0FBQVI7QUFKVyxDQUFyQjtBQU9BRixTQUFTLENBQUNLLE1BQVYsQ0FBaUJFLEdBQWpCLEdBQXVCUCxTQUFTLENBQUNHLElBQVYsQ0FBZUQsSUFBdEM7QUFDQUYsU0FBUyxDQUFDSSxHQUFWLENBQWNHLEdBQWQsR0FBb0JQLFNBQVMsQ0FBQ0MsS0FBVixDQUFnQkMsSUFBcEM7QUFDQUYsU0FBUyxDQUFDRyxJQUFWLENBQWVJLEdBQWYsR0FBcUJQLFNBQVMsQ0FBQ0ssTUFBVixDQUFpQkgsSUFBdEM7QUFDQUYsU0FBUyxDQUFDQyxLQUFWLENBQWdCTSxHQUFoQixHQUFzQlAsU0FBUyxDQUFDSSxHQUFWLENBQWNGLElBQXBDO0FBRUFJLE9BQU8sQ0FBQ0QsTUFBUixDQUFlRSxHQUFmLEdBQXFCRCxPQUFPLENBQUNILElBQVIsQ0FBYUQsSUFBbEM7QUFDQUksT0FBTyxDQUFDRixHQUFSLENBQVlHLEdBQVosR0FBa0JELE9BQU8sQ0FBQ0wsS0FBUixDQUFjQyxJQUFoQztBQUNBSSxPQUFPLENBQUNILElBQVIsQ0FBYUksR0FBYixHQUFtQkQsT0FBTyxDQUFDRCxNQUFSLENBQWVILElBQWxDO0FBQ0FJLE9BQU8sQ0FBQ0wsS0FBUixDQUFjTSxHQUFkLEdBQW9CRCxPQUFPLENBQUNGLEdBQVIsQ0FBWUYsSUFBaEM7O0FBRUEsU0FBU00sZUFBVCxDQUF5QkMsUUFBekIsRUFBbUNDLEVBQW5DLEVBQXVDQyxJQUF2QyxFQUE2QztBQUMzQyxNQUFJRCxFQUFFLEdBQUdDLElBQVQsRUFBZTtBQUNiRixJQUFBQSxRQUFRLENBQUMsQ0FBRCxDQUFSLEdBQWMsQ0FBQ0EsUUFBUSxDQUFDLENBQUQsQ0FBUixHQUFjQSxRQUFRLENBQUMsQ0FBRCxDQUF2QixJQUE4QixDQUE1QztBQUNELEdBRkQsTUFFTztBQUNMQSxJQUFBQSxRQUFRLENBQUMsQ0FBRCxDQUFSLEdBQWMsQ0FBQ0EsUUFBUSxDQUFDLENBQUQsQ0FBUixHQUFjQSxRQUFRLENBQUMsQ0FBRCxDQUF2QixJQUE4QixDQUE1QztBQUNEO0FBQ0Y7O0FBRUQsU0FBU0csaUJBQVQsQ0FBMkJDLE9BQTNCLEVBQW9DQyxHQUFwQyxFQUF5QztBQUN2Q0QsRUFBQUEsT0FBTyxHQUFHQSxPQUFPLENBQUNFLFdBQVIsRUFBVjtBQUNBLE1BQU1DLE9BQU8sR0FBR0gsT0FBTyxDQUFDSSxNQUFSLENBQWVKLE9BQU8sQ0FBQ0ssTUFBUixHQUFpQixDQUFoQyxDQUFoQjtBQUNBLE1BQU1DLElBQUksR0FBR04sT0FBTyxDQUFDSyxNQUFSLEdBQWlCLENBQWpCLEdBQXFCLEtBQXJCLEdBQTZCLE1BQTFDO0FBQ0EsTUFBSUUsSUFBSSxHQUFHUCxPQUFPLENBQUNRLFNBQVIsQ0FBa0IsQ0FBbEIsRUFBcUJSLE9BQU8sQ0FBQ0ssTUFBUixHQUFpQixDQUF0QyxDQUFYOztBQUNBLE1BQUlaLE9BQU8sQ0FBQ1EsR0FBRCxDQUFQLENBQWFLLElBQWIsRUFBbUJHLE9BQW5CLENBQTJCTixPQUEzQixNQUF3QyxDQUFDLENBQTdDLEVBQWdEO0FBQzlDSSxJQUFBQSxJQUFJLEdBQUdSLGlCQUFpQixDQUFDUSxJQUFELEVBQU9OLEdBQVAsQ0FBeEI7QUFDRDs7QUFDRCxTQUFPTSxJQUFJLEdBQUdyQixNQUFNLENBQUNDLFNBQVMsQ0FBQ2MsR0FBRCxDQUFULENBQWVLLElBQWYsRUFBcUJHLE9BQXJCLENBQTZCTixPQUE3QixDQUFELENBQXBCO0FBQ0Q7O0FBRUQsU0FBU08sYUFBVCxDQUF1QkMsT0FBdkIsRUFBZ0M7QUFDOUIsTUFBSUMsTUFBVyxHQUFHLENBQWxCO0FBQ0EsTUFBTUMsR0FBUSxHQUFHLEVBQWpCO0FBQ0EsTUFBTUMsR0FBUSxHQUFHLEVBQWpCO0FBQ0FELEVBQUFBLEdBQUcsQ0FBQyxDQUFELENBQUgsR0FBUyxDQUFDLElBQVY7QUFDQUEsRUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTLElBQVQ7QUFDQUMsRUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTLENBQUMsS0FBVjtBQUNBQSxFQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILEdBQVMsS0FBVDtBQUNBLE1BQUlDLE1BQU0sR0FBRyxJQUFiO0FBQ0EsTUFBSUMsTUFBTSxHQUFHLEtBQWI7O0FBQ0EsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHTixPQUFPLENBQUNOLE1BQTVCLEVBQW9DWSxDQUFDLEVBQXJDLEVBQXlDO0FBQ3ZDLFFBQU1DLENBQUMsR0FBR1AsT0FBTyxDQUFDTSxDQUFELENBQWpCO0FBQ0EsUUFBTXBCLEVBQUUsR0FBR1gsTUFBTSxDQUFDdUIsT0FBUCxDQUFlUyxDQUFmLENBQVg7O0FBQ0EsU0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLENBQXBCLEVBQXVCQSxDQUFDLEVBQXhCLEVBQTRCO0FBQzFCLFVBQU1yQixJQUFJLEdBQUdiLElBQUksQ0FBQ2tDLENBQUQsQ0FBakI7O0FBQ0EsVUFBSVAsTUFBSixFQUFZO0FBQ1ZJLFFBQUFBLE1BQU0sSUFBSSxDQUFWO0FBQ0FyQixRQUFBQSxlQUFlLENBQUNtQixHQUFELEVBQU1qQixFQUFOLEVBQVVDLElBQVYsQ0FBZjtBQUNELE9BSEQsTUFHTztBQUNMaUIsUUFBQUEsTUFBTSxJQUFJLENBQVY7QUFDQXBCLFFBQUFBLGVBQWUsQ0FBQ2tCLEdBQUQsRUFBTWhCLEVBQU4sRUFBVUMsSUFBVixDQUFmO0FBQ0Q7O0FBQ0RjLE1BQUFBLE1BQU0sR0FBRyxDQUFDQSxNQUFWO0FBQ0Q7QUFDRjs7QUFDREMsRUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTLENBQUNBLEdBQUcsQ0FBQyxDQUFELENBQUgsR0FBU0EsR0FBRyxDQUFDLENBQUQsQ0FBYixJQUFvQixDQUE3QjtBQUNBQyxFQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILEdBQVMsQ0FBQ0EsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTQSxHQUFHLENBQUMsQ0FBRCxDQUFiLElBQW9CLENBQTdCO0FBQ0EsU0FBTztBQUFFTSxJQUFBQSxRQUFRLEVBQUVQLEdBQVo7QUFBaUJRLElBQUFBLFNBQVMsRUFBRVA7QUFBNUIsR0FBUDtBQUNEOztBQUVNLFNBQVNRLGFBQVQsQ0FBdUJGLFFBQXZCLEVBQWlDQyxTQUFqQyxFQUE0QztBQUNqRCxNQUFJVCxNQUFXLEdBQUcsQ0FBbEI7QUFDQSxNQUFNSyxDQUFDLEdBQUcsQ0FBVjtBQUNBLE1BQU1KLEdBQVEsR0FBRyxFQUFqQjtBQUNBLE1BQU1DLEdBQVEsR0FBRyxFQUFqQjtBQUNBLE1BQUlTLEdBQUcsR0FBRyxDQUFWO0FBQ0EsTUFBSUMsRUFBRSxHQUFHLENBQVQ7QUFDQSxNQUFNQyxTQUFTLEdBQUcsRUFBbEI7QUFDQSxNQUFJZCxPQUFPLEdBQUcsRUFBZDtBQUNBRSxFQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILEdBQVMsQ0FBQyxJQUFWO0FBQ0FBLEVBQUFBLEdBQUcsQ0FBQyxDQUFELENBQUgsR0FBUyxJQUFUO0FBQ0FDLEVBQUFBLEdBQUcsQ0FBQyxDQUFELENBQUgsR0FBUyxDQUFDLEtBQVY7QUFDQUEsRUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTLEtBQVQ7QUFDQSxNQUFJWSxHQUFKOztBQUNBLFNBQU9mLE9BQU8sQ0FBQ04sTUFBUixHQUFpQm9CLFNBQXhCLEVBQW1DO0FBQ2pDLFFBQUliLE1BQUosRUFBWTtBQUNWYyxNQUFBQSxHQUFHLEdBQUcsQ0FBQ1osR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTQSxHQUFHLENBQUMsQ0FBRCxDQUFiLElBQW9CLENBQTFCOztBQUNBLFVBQUlPLFNBQVMsR0FBR0ssR0FBaEIsRUFBcUI7QUFDbkJGLFFBQUFBLEVBQUUsSUFBSXZDLElBQUksQ0FBQ3NDLEdBQUQsQ0FBVjtBQUNBVCxRQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILEdBQVNZLEdBQVQ7QUFDRCxPQUhELE1BR087QUFDTFosUUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTWSxHQUFUO0FBQ0Q7QUFDRixLQVJELE1BUU87QUFDTEEsTUFBQUEsR0FBRyxHQUFHLENBQUNiLEdBQUcsQ0FBQyxDQUFELENBQUgsR0FBU0EsR0FBRyxDQUFDLENBQUQsQ0FBYixJQUFvQixDQUExQjs7QUFDQSxVQUFJTyxRQUFRLEdBQUdNLEdBQWYsRUFBb0I7QUFDbEJGLFFBQUFBLEVBQUUsSUFBSXZDLElBQUksQ0FBQ3NDLEdBQUQsQ0FBVjtBQUNBVixRQUFBQSxHQUFHLENBQUMsQ0FBRCxDQUFILEdBQVNhLEdBQVQ7QUFDRCxPQUhELE1BR087QUFDTGIsUUFBQUEsR0FBRyxDQUFDLENBQUQsQ0FBSCxHQUFTYSxHQUFUO0FBQ0Q7QUFDRjs7QUFDRGQsSUFBQUEsTUFBTSxHQUFHLENBQUNBLE1BQVY7O0FBQ0EsUUFBSVcsR0FBRyxHQUFHLENBQVYsRUFBYTtBQUNYQSxNQUFBQSxHQUFHO0FBQ0osS0FGRCxNQUVPO0FBQ0xaLE1BQUFBLE9BQU8sSUFBSXpCLE1BQU0sQ0FBQ3NDLEVBQUQsQ0FBakI7QUFDQUQsTUFBQUEsR0FBRyxHQUFHLENBQU47QUFDQUMsTUFBQUEsRUFBRSxHQUFHLENBQUw7QUFDRDtBQUNGOztBQUNELFNBQU9iLE9BQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGdlb2hhc2guanNcbi8vIEdlb2hhc2ggbGlicmFyeSBmb3IgSmF2YXNjcmlwdFxuLy8gKGMpIDIwMDggRGF2aWQgVHJveVxuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlXG5cbmNvbnN0IEJJVFMgPSBbMTYsIDgsIDQsIDIsIDFdXG5jb25zdCBCQVNFMzIgPSAnMDEyMzQ1Njc4OWJjZGVmZ2hqa21ucHFyc3R1dnd4eXonXG5cbmNvbnN0IE5FSUdIQk9SUzogYW55ID0ge1xuICByaWdodDogeyBldmVuOiAnYmMwMWZnNDUyMzg5NjdkZXV2aGp5em5wa21zdHFyd3gnIH0sXG4gIGxlZnQ6IHsgZXZlbjogJzIzODk2N2RlYmMwMWZnNDVrbXN0cXJ3eHV2aGp5em5wJyB9LFxuICB0b3A6IHsgZXZlbjogJ3AwcjIxNDM2eDh6YjlkY2Y1aDdram5tcWVzZ3V0d3Z5JyB9LFxuICBib3R0b206IHsgZXZlbjogJzE0MzY1aDdrOWRjZmVzZ3Vqbm1xcDByMnR3dnl4OHpiJyB9XG59XG5jb25zdCBCT1JERVJTOiBhbnkgPSB7XG4gIHJpZ2h0OiB7IGV2ZW46ICdiY2ZndXZ5eicgfSxcbiAgbGVmdDogeyBldmVuOiAnMDE0NWhqbnAnIH0sXG4gIHRvcDogeyBldmVuOiAncHJ4eicgfSxcbiAgYm90dG9tOiB7IGV2ZW46ICcwMjhiJyB9XG59XG5cbk5FSUdIQk9SUy5ib3R0b20ub2RkID0gTkVJR0hCT1JTLmxlZnQuZXZlblxuTkVJR0hCT1JTLnRvcC5vZGQgPSBORUlHSEJPUlMucmlnaHQuZXZlblxuTkVJR0hCT1JTLmxlZnQub2RkID0gTkVJR0hCT1JTLmJvdHRvbS5ldmVuXG5ORUlHSEJPUlMucmlnaHQub2RkID0gTkVJR0hCT1JTLnRvcC5ldmVuXG5cbkJPUkRFUlMuYm90dG9tLm9kZCA9IEJPUkRFUlMubGVmdC5ldmVuXG5CT1JERVJTLnRvcC5vZGQgPSBCT1JERVJTLnJpZ2h0LmV2ZW5cbkJPUkRFUlMubGVmdC5vZGQgPSBCT1JERVJTLmJvdHRvbS5ldmVuXG5CT1JERVJTLnJpZ2h0Lm9kZCA9IEJPUkRFUlMudG9wLmV2ZW5cblxuZnVuY3Rpb24gcmVmaW5lX2ludGVydmFsKGludGVydmFsLCBjZCwgbWFzaykge1xuICBpZiAoY2QgJiBtYXNrKSB7XG4gICAgaW50ZXJ2YWxbMF0gPSAoaW50ZXJ2YWxbMF0gKyBpbnRlcnZhbFsxXSkgLyAyXG4gIH0gZWxzZSB7XG4gICAgaW50ZXJ2YWxbMV0gPSAoaW50ZXJ2YWxbMF0gKyBpbnRlcnZhbFsxXSkgLyAyXG4gIH1cbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQWRqYWNlbnQoc3JjSGFzaCwgZGlyKSB7XG4gIHNyY0hhc2ggPSBzcmNIYXNoLnRvTG93ZXJDYXNlKClcbiAgY29uc3QgbGFzdENociA9IHNyY0hhc2guY2hhckF0KHNyY0hhc2gubGVuZ3RoIC0gMSlcbiAgY29uc3QgdHlwZSA9IHNyY0hhc2gubGVuZ3RoICUgMiA/ICdvZGQnIDogJ2V2ZW4nXG4gIGxldCBiYXNlID0gc3JjSGFzaC5zdWJzdHJpbmcoMCwgc3JjSGFzaC5sZW5ndGggLSAxKVxuICBpZiAoQk9SREVSU1tkaXJdW3R5cGVdLmluZGV4T2YobGFzdENocikgIT09IC0xKSB7XG4gICAgYmFzZSA9IGNhbGN1bGF0ZUFkamFjZW50KGJhc2UsIGRpcilcbiAgfVxuICByZXR1cm4gYmFzZSArIEJBU0UzMltORUlHSEJPUlNbZGlyXVt0eXBlXS5pbmRleE9mKGxhc3RDaHIpXVxufVxuXG5mdW5jdGlvbiBkZWNvZGVHZW9IYXNoKGdlb2hhc2gpIHtcbiAgbGV0IGlzRXZlbjogYW55ID0gMVxuICBjb25zdCBsYXQ6IGFueSA9IFtdXG4gIGNvbnN0IGxvbjogYW55ID0gW11cbiAgbGF0WzBdID0gLTkwLjBcbiAgbGF0WzFdID0gOTAuMFxuICBsb25bMF0gPSAtMTgwLjBcbiAgbG9uWzFdID0gMTgwLjBcbiAgbGV0IGxhdEVyciA9IDkwLjBcbiAgbGV0IGxvbkVyciA9IDE4MC4wXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZ2VvaGFzaC5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGMgPSBnZW9oYXNoW2ldXG4gICAgY29uc3QgY2QgPSBCQVNFMzIuaW5kZXhPZihjKVxuICAgIGZvciAobGV0IGogPSAwOyBqIDwgNTsgaisrKSB7XG4gICAgICBjb25zdCBtYXNrID0gQklUU1tqXVxuICAgICAgaWYgKGlzRXZlbikge1xuICAgICAgICBsb25FcnIgLz0gMlxuICAgICAgICByZWZpbmVfaW50ZXJ2YWwobG9uLCBjZCwgbWFzaylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxhdEVyciAvPSAyXG4gICAgICAgIHJlZmluZV9pbnRlcnZhbChsYXQsIGNkLCBtYXNrKVxuICAgICAgfVxuICAgICAgaXNFdmVuID0gIWlzRXZlblxuICAgIH1cbiAgfVxuICBsYXRbMl0gPSAobGF0WzBdICsgbGF0WzFdKSAvIDJcbiAgbG9uWzJdID0gKGxvblswXSArIGxvblsxXSkgLyAyXG4gIHJldHVybiB7IGxhdGl0dWRlOiBsYXQsIGxvbmdpdHVkZTogbG9uIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuY29kZUdlb0hhc2gobGF0aXR1ZGUsIGxvbmdpdHVkZSkge1xuICBsZXQgaXNFdmVuOiBhbnkgPSAxXG4gIGNvbnN0IGkgPSAwXG4gIGNvbnN0IGxhdDogYW55ID0gW11cbiAgY29uc3QgbG9uOiBhbnkgPSBbXVxuICBsZXQgYml0ID0gMFxuICBsZXQgY2ggPSAwXG4gIGNvbnN0IHByZWNpc2lvbiA9IDEyXG4gIGxldCBnZW9oYXNoID0gJydcbiAgbGF0WzBdID0gLTkwLjBcbiAgbGF0WzFdID0gOTAuMFxuICBsb25bMF0gPSAtMTgwLjBcbiAgbG9uWzFdID0gMTgwLjBcbiAgbGV0IG1pZFxuICB3aGlsZSAoZ2VvaGFzaC5sZW5ndGggPCBwcmVjaXNpb24pIHtcbiAgICBpZiAoaXNFdmVuKSB7XG4gICAgICBtaWQgPSAobG9uWzBdICsgbG9uWzFdKSAvIDJcbiAgICAgIGlmIChsb25naXR1ZGUgPiBtaWQpIHtcbiAgICAgICAgY2ggfD0gQklUU1tiaXRdXG4gICAgICAgIGxvblswXSA9IG1pZFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9uWzFdID0gbWlkXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG1pZCA9IChsYXRbMF0gKyBsYXRbMV0pIC8gMlxuICAgICAgaWYgKGxhdGl0dWRlID4gbWlkKSB7XG4gICAgICAgIGNoIHw9IEJJVFNbYml0XVxuICAgICAgICBsYXRbMF0gPSBtaWRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxhdFsxXSA9IG1pZFxuICAgICAgfVxuICAgIH1cbiAgICBpc0V2ZW4gPSAhaXNFdmVuXG4gICAgaWYgKGJpdCA8IDQpIHtcbiAgICAgIGJpdCsrXG4gICAgfSBlbHNlIHtcbiAgICAgIGdlb2hhc2ggKz0gQkFTRTMyW2NoXVxuICAgICAgYml0ID0gMFxuICAgICAgY2ggPSAwXG4gICAgfVxuICB9XG4gIHJldHVybiBnZW9oYXNoXG59XG4iXX0=