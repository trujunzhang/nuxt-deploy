"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Users = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _tools = require("@app/tools");

var _types = require("@app/types");

var _index = require("./index");

var Users = /*#__PURE__*/function () {
  function Users() {
    (0, _classCallCheck2["default"])(this, Users);
  }

  (0, _createClass2["default"])(Users, null, [{
    key: "isLoggedUser",

    /**
     * Sometimes, If the users run the 'IEATTA' app, but network is unavailability.
     * So give the users the 'anonymous' user firstly to let them can use the app.
     *
     * The uniqueId and the password is the same as '12345654321'.
     *
     * @type {{id: null, name: string, slug: string, email: string, loginType: string, uniqueId: string}}
     */
    value: function isLoggedUser(userProfile, currentUser) {
      if (!!currentUser && !!userProfile && userProfile.id === currentUser.id) {
        return true;
      }

      return false;
    }
    /**
     * @summary Get a user's email hash
     * @param {Object} user
     */

  }, {
    key: "getEmailHash",
    value: function getEmailHash(user) {
      return _tools.Md5Utils.getMd5String(user.email);
    }
  }, {
    key: "getCreatedAtFormat",
    value: function getCreatedAtFormat(user) {
      return _tools.MomentUtils.toDateString(user.createdAt, Users.config.dateFormat);
    }
  }, {
    key: "getOrderedUserFormat",
    value: function getOrderedUserFormat(peopleInEvent) {
      return _tools.MomentUtils.toDateString(peopleInEvent.createdAt, Users.config.orderedDataFormat);
    }
  }, {
    key: "getInviteEmailObject",
    value: function getInviteEmailObject(props) {
      var auth = props.auth;
      var size = 0;
      var emails = {
        0: '',
        1: '',
        2: ''
      };
      var email = auth.form.fields.email;

      if (email !== '') {
        size++;
        emails[0] = email;
      }

      var email1 = auth.form.fields.email1;

      if (email1 !== '') {
        size++;
        emails[1] = email1;
      }

      var email2 = auth.form.fields.email2;

      if (email2 !== '') {
        size++;
        emails[2] = email2;
      }

      return {
        size: size,
        emails: emails
      };
    }
  }, {
    key: "getSelectedUserIndex",
    value: function getSelectedUserIndex(newListTask, selectedPhotoInfo) {
      var results = newListTask.results;
      var userId = selectedPhotoInfo.userId;

      var selectedUserIndex = _tools.UnderscoreUtils.findIndexInArray({
        array: results,
        predicate: function predicate(item) {
          return item.id === userId;
        }
      });

      if (selectedUserIndex === -1) {
        selectedUserIndex = 0;
      }

      var selectedUserId = results.length > 0 ? results[selectedUserIndex].id : null;
      return {
        selectedUserIndex: selectedUserIndex,
        selectedUserId: selectedUserId
      };
    }
  }]);
  return Users;
}();

exports.Users = Users;
Users.defaultLoginType = _types.StatusConstants.appDefaultLoginType;
Users.anonymousUser = {
  id: 'anony_id',
  uniqueId: 'anony_unique_id',
  slug: 'anony_user',
  username: 'anonymous',
  displayName: 'anonymous',
  facebookLinked: false,
  twitterLinked: false,
  email: '',
  loginType: Users.defaultLoginType,
  createdAt: new Date(),
  updatedAt: new Date(),
  syncPostedAt: new Date(),
  flag: _index.Flags.normalState,
  creator: null
};
Users.config = {
  // February 2014
  dateFormat: 'MMMM YYYY',
  orderedDataFormat: 'DD, MMMM, YYYY',
  TYPE_EMAIL: _types.StatusConstants.USERS.TYPE_EMAIL,
  TYPE_TWITTER: _types.StatusConstants.USERS.TYPE_TWITTER,
  TYPE_FACEBOOK: _types.StatusConstants.USERS.TYPE_FACEBOOK,
  TYPE_GOOGLE: _types.StatusConstants.USERS.TYPE_GOOGLE,
  TYPE_GITHUB: _types.StatusConstants.USERS.TYPE_GITHUB,
  TYPE_LINKEDIN: _types.StatusConstants.USERS.TYPE_LINKEDIN,
  TYPE_TITLES: _types.StatusConstants.USERS.TYPE_TITLES
};
Users.profileLeftMenus = {
  LOGGED_USER_INVITE_FORM: {
    tag: 'invite',
    path: 'invite'
  },
  LOGGED_USER_EDIT_FORM: {
    tag: 'edit',
    path: 'profile'
  },
  LOGGED_USER_MENU_ABOUT: {
    tag: 'profile',
    title: 'Profile Overview',
    svg: 'M3 21.002h18a12.703 12.703 0 0 0-7.28-3.583v-1.46c1.156-.845 2.23-2.25 2.302-3.168 1.307-.634 1.58-2.213.65-2.562l-.02.03c.42-.587.677-1.335.677-2.192 0-1.11-.2-2.136-1.017-2.806-.567-1.34-1.746-2.266-3.116-2.266-.804 0-1.54.32-2.13.854a1.223 1.223 0 0 0-.787-.297c-.514 0-.96.345-1.2.852-1.294.478-2.236 1.936-2.236 3.663 0 .79.198 1.526.536 2.136-1 .394-.666 1.9.595 2.59.074.915 1.147 2.322 2.302 3.166v1.457A12.725 12.725 0 0 0 3 21z',
    path: 'user_details'
  },
  LOGGED_USER_MENU_REVIEWS: {
    tag: 'review',
    title: 'Reviews',
    svg: 'M21 6a3 3 0 0 0-3-3H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3V6zm-5.88 10.428l-3.16-1.938-3.05 2.01.59-3.457L7 10.596l3.457-.505L11.96 6.5l1.582 3.59 3.458.506-2.5 2.447.62 3.385z',
    path: 'user_details_reviews_self'
  },
  LOGGED_USER_MENU_BROWSER_PHOTOS: {
    tag: 'camera',
    title: 'Browser Photos',
    svg: 'M19 20H5a3 3 0 0 1-3-3V9a3 3 0 0 1 3-3h2.184A2.99 2.99 0 0 1 10 4h4a2.99 2.99 0 0 1 2.816 2H19a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3zM12.005 8.5a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9zm0 7a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z',
    path: 'user_local_photos'
  },
  LOGGED_USER_MENU_EVENTS: {
    tag: 'event',
    title: 'Events',
    svg: 'M18 21H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3 1 1 0 0 1 2 0h8a1 1 0 0 1 2 0 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3zm1-13H5v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V8zm-5.634 7.723L12 18l-1.366-2.277a3.5 3.5 0 1 1 2.732 0zM12 11.25a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5z',
    path: 'user_details_events'
  },
  LOGGED_USER_MENU_RECIPES: {
    tag: 'recipe',
    title: 'Recipes',
    svg: 'M17.22 22a1.78 1.78 0 0 1-1.74-2.167l1.298-4.98L14 13l1.756-9.657A1.635 1.635 0 0 1 19 3.635V20.22A1.78 1.78 0 0 1 17.22 22zm-7.138-9.156l.697 7.168a1.79 1.79 0 1 1-3.56 0l.7-7.178A3.985 3.985 0 0 1 5 9V3a1 1 0 0 1 2 0v5.5c0 .28.22.5.5.5s.5-.22.5-.5V3a1 1 0 0 1 2 0v5.5c0 .28.22.5.5.5s.5-.22.5-.5V3a1 1 0 0 1 2 0v5.83c0 1.85-1.2 3.518-2.918 4.014z',
    path: 'user_details_recipes'
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHBMaWJzL3VzZXJzLnRzIl0sIm5hbWVzIjpbIlVzZXJzIiwidXNlclByb2ZpbGUiLCJjdXJyZW50VXNlciIsImlkIiwidXNlciIsIk1kNVV0aWxzIiwiZ2V0TWQ1U3RyaW5nIiwiZW1haWwiLCJNb21lbnRVdGlscyIsInRvRGF0ZVN0cmluZyIsImNyZWF0ZWRBdCIsImNvbmZpZyIsImRhdGVGb3JtYXQiLCJwZW9wbGVJbkV2ZW50Iiwib3JkZXJlZERhdGFGb3JtYXQiLCJwcm9wcyIsImF1dGgiLCJzaXplIiwiZW1haWxzIiwiZm9ybSIsImZpZWxkcyIsImVtYWlsMSIsImVtYWlsMiIsIm5ld0xpc3RUYXNrIiwic2VsZWN0ZWRQaG90b0luZm8iLCJyZXN1bHRzIiwidXNlcklkIiwic2VsZWN0ZWRVc2VySW5kZXgiLCJVbmRlcnNjb3JlVXRpbHMiLCJmaW5kSW5kZXhJbkFycmF5IiwiYXJyYXkiLCJwcmVkaWNhdGUiLCJpdGVtIiwic2VsZWN0ZWRVc2VySWQiLCJsZW5ndGgiLCJkZWZhdWx0TG9naW5UeXBlIiwiU3RhdHVzQ29uc3RhbnRzIiwiYXBwRGVmYXVsdExvZ2luVHlwZSIsImFub255bW91c1VzZXIiLCJ1bmlxdWVJZCIsInNsdWciLCJ1c2VybmFtZSIsImRpc3BsYXlOYW1lIiwiZmFjZWJvb2tMaW5rZWQiLCJ0d2l0dGVyTGlua2VkIiwibG9naW5UeXBlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInN5bmNQb3N0ZWRBdCIsImZsYWciLCJGbGFncyIsIm5vcm1hbFN0YXRlIiwiY3JlYXRvciIsIlRZUEVfRU1BSUwiLCJVU0VSUyIsIlRZUEVfVFdJVFRFUiIsIlRZUEVfRkFDRUJPT0siLCJUWVBFX0dPT0dMRSIsIlRZUEVfR0lUSFVCIiwiVFlQRV9MSU5LRURJTiIsIlRZUEVfVElUTEVTIiwicHJvZmlsZUxlZnRNZW51cyIsIkxPR0dFRF9VU0VSX0lOVklURV9GT1JNIiwidGFnIiwicGF0aCIsIkxPR0dFRF9VU0VSX0VESVRfRk9STSIsIkxPR0dFRF9VU0VSX01FTlVfQUJPVVQiLCJ0aXRsZSIsInN2ZyIsIkxPR0dFRF9VU0VSX01FTlVfUkVWSUVXUyIsIkxPR0dFRF9VU0VSX01FTlVfQlJPV1NFUl9QSE9UT1MiLCJMT0dHRURfVVNFUl9NRU5VX0VWRU5UUyIsIkxPR0dFRF9VU0VSX01FTlVfUkVDSVBFUyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUdBOztJQUdhQSxLOzs7Ozs7OztBQUVYOzs7Ozs7OztpQ0FrRm9CQyxXLEVBQWFDLFcsRUFBYTtBQUM1QyxVQUFJLENBQUMsQ0FBQ0EsV0FBRixJQUFpQixDQUFDLENBQUNELFdBQW5CLElBQWtDQSxXQUFXLENBQUNFLEVBQVosS0FBbUJELFdBQVcsQ0FBQ0MsRUFBckUsRUFBeUU7QUFDdkUsZUFBTyxJQUFQO0FBQ0Q7O0FBQ0QsYUFBTyxLQUFQO0FBQ0Q7QUFFRDs7Ozs7OztpQ0FJb0JDLEksRUFBd0I7QUFDMUMsYUFBT0MsZ0JBQVNDLFlBQVQsQ0FBc0JGLElBQUksQ0FBQ0csS0FBM0IsQ0FBUDtBQUNEOzs7dUNBRXlCSCxJLEVBQU07QUFDOUIsYUFBT0ksbUJBQVlDLFlBQVosQ0FBeUJMLElBQUksQ0FBQ00sU0FBOUIsRUFBeUNWLEtBQUssQ0FBQ1csTUFBTixDQUFhQyxVQUF0RCxDQUFQO0FBQ0Q7Ozt5Q0FFMkJDLGEsRUFBZTtBQUN6QyxhQUFPTCxtQkFBWUMsWUFBWixDQUF5QkksYUFBYSxDQUFDSCxTQUF2QyxFQUFrRFYsS0FBSyxDQUFDVyxNQUFOLENBQWFHLGlCQUEvRCxDQUFQO0FBQ0Q7Ozt5Q0FFMkJDLEssRUFBTztBQUFBLFVBQ3pCQyxJQUR5QixHQUNoQkQsS0FEZ0IsQ0FDekJDLElBRHlCO0FBRWpDLFVBQUlDLElBQUksR0FBRyxDQUFYO0FBQ0EsVUFBTUMsTUFBVyxHQUFHO0FBQ2xCLFdBQUcsRUFEZTtBQUVsQixXQUFHLEVBRmU7QUFHbEIsV0FBRztBQUhlLE9BQXBCO0FBS0EsVUFBTVgsS0FBSyxHQUFHUyxJQUFJLENBQUNHLElBQUws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QUFBLElBQUksRUFBRTtBQUx5QixHQXZCVDtBQThCeEJPLEVBQUFBLHVCQUF1QixFQUFFO0FBQ3ZCUixJQUFBQSxHQUFHLEVBQUUsT0FEa0I7QUFFdkJJLElBQUFBLEtBQUssRUFBRSxRQUZnQjtBQUd2QkMsSUFBQUEsR0FBRyxFQUNELGtRQUpxQjtBQUt2QkosSUFBQUEsSUFBSSxFQUFFO0FBTGlCLEdBOUJEO0FBcUN4QlEsRUFBQUEsd0JBQXdCLEVBQUU7QUFDeEJULElBQUFBLEdBQUcsRUFBRSxRQURtQjtBQUV4QkksSUFBQUEsS0FBSyxFQUFFLFNBRmlCO0FBR3hCQyxJQUFBQSxHQUFHLEVBQ0QsNlZBSnNCO0FBS3hCSixJQUFBQSxJQUFJLEVBQUU7QUFMa0I7QUFyQ0YsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVuZGVyc2NvcmVVdGlscyB9IGZyb20gJ0BhcHAvdG9vbHMnXG5pbXBvcnQgeyBTdGF0dXNDb25zdGFudHMgfSBmcm9tICdAYXBwL3R5cGVzJ1xuaW1wb3J0IHsgTW9tZW50VXRpbHMgfSBmcm9tICdAYXBwL3Rvb2xzJ1xuXG5pbXBvcnQgeyBGbGFncyB9IGZyb20gJy4vaW5kZXgnXG5pbXBvcnQgeyBNZDVVdGlscyB9IGZyb20gJ0BhcHAvdG9vbHMnXG5cbmV4cG9ydCBjbGFzcyBVc2VycyB7XG4gIHN0YXRpYyBkZWZhdWx0TG9naW5UeXBlID0gU3RhdHVzQ29uc3RhbnRzLmFwcERlZmF1bHRMb2dpblR5cGVcbiAgLyoqXG4gICAqIFNvbWV0aW1lcywgSWYgdGhlIHVzZXJzIHJ1biB0aGUgJ0lFQVRUQScgYXBwLCBidXQgbmV0d29yayBpcyB1bmF2YWlsYWJpbGl0eS5cbiAgICogU28gZ2l2ZSB0aGUgdXNlcnMgdGhlICdhbm9ueW1vdXMnIHVzZXIgZmlyc3RseSB0byBsZXQgdGhlbSBjYW4gdXNlIHRoZSBhcHAuXG4gICAqXG4gICAqIFRoZSB1bmlxdWVJZCBhbmQgdGhlIHBhc3N3b3JkIGlzIHRoZSBzYW1lIGFzICcxMjM0NTY1NDMyMScuXG4gICAqXG4gICAqIEB0eXBlIHt7aWQ6IG51bGwsIG5hbWU6IHN0cmluZywgc2x1Zzogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBsb2dpblR5cGU6IHN0cmluZywgdW5pcXVlSWQ6IHN0cmluZ319XG4gICAqL1xuICBzdGF0aWMgYW5vbnltb3VzVXNlcjogSVBhcnNlTW9kZWxVc2VycyA9IHtcbiAgICBpZDogJ2Fub255X2lkJyxcbiAgICB1bmlxdWVJZDogJ2Fub255X3VuaXF1ZV9pZCcsXG4gICAgc2x1ZzogJ2Fub255X3VzZXInLFxuICAgIHVzZXJuYW1lOiAnYW5vbnltb3VzJyxcbiAgICBkaXNwbGF5TmFtZTogJ2Fub255bW91cycsXG4gICAgZmFjZWJvb2tMaW5rZWQ6IGZhbHNlLFxuICAgIHR3aXR0ZXJMaW5rZWQ6IGZhbHNlLFxuICAgIGVtYWlsOiAnJyxcbiAgICBsb2dpblR5cGU6IFVzZXJzLmRlZmF1bHRMb2dpblR5cGUsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICBzeW5jUG9zdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgZmxhZzogRmxhZ3Mubm9ybWFsU3RhdGUsXG4gICAgY3JlYXRvcjogbnVsbFxuICB9XG4gIHN0YXRpYyBjb25maWcgPSB7XG4gICAgLy8gRmVicnVhcnkgMjAxNFxuICAgIGRhdGVGb3JtYXQ6ICdNTU1NIFlZWVknLFxuICAgIG9yZGVyZWREYXRhRm9ybWF0OiAnREQsIE1NTU0sIFlZWVknLFxuICAgIFRZUEVfRU1BSUw6IFN0YXR1c0NvbnN0YW50cy5VU0VSUy5UWVBFX0VNQUlMLFxuICAgIFRZUEVfVFdJVFRFUjogU3RhdHVzQ29uc3RhbnRzLlVTRVJTLlRZUEVfVFdJVFRFUixcbiAgICBUWVBFX0ZBQ0VCT09LOiBTdGF0dXNDb25zdGFudHMuVVNFUlMuVFlQRV9GQUNFQk9PSyxcbiAgICBUWVBFX0dPT0dMRTogU3RhdHVzQ29uc3RhbnRzLlVTRVJTLlRZUEVfR09PR0xFLFxuICAgIFRZUEVfR0lUSFVCOiBTdGF0dXNDb25zdGFudHMuVVNFUlMuVFlQRV9HSVRIVUIsXG4gICAgVFlQRV9MSU5LRURJTjogU3RhdHVzQ29uc3RhbnRzLlVTRVJTLlRZUEVfTElOS0VESU4sXG4gICAgVFlQRV9USVRMRVM6IFN0YXR1c0NvbnN0YW50cy5VU0VSUy5UWVBFX1RJVExFU1xuICB9XG4gIHN0YXRpYyBwcm9maWxlTGVmdE1lbnVzID0ge1xuICAgIExPR0dFRF9VU0VSX0lOVklURV9GT1JNOiB7XG4gICAgICB0YWc6ICdpbnZpdGUnLFxuICAgICAgcGF0aDogJ2ludml0ZSdcbiAgICB9LFxuICAgIExPR0dFRF9VU0VSX0VESVRfRk9STToge1xuICAgICAgdGFnOiAnZWRpdCcsXG4gICAgICBwYXRoOiAncHJvZmlsZSdcbiAgICB9LFxuICAgIExPR0dFRF9VU0VSX01FTlVfQUJPVVQ6IHtcbiAgICAgIHRhZzogJ3Byb2ZpbGUnLFxuICAgICAgdGl0bGU6ICdQcm9maWxlIE92ZXJ2aWV3JyxcbiAgICAgIHN2ZzpcbiAgICAgICAgJ00zIDIxLjAwMmgxOGExMi43MDMgMTIuNzAzIDAgMCAwLTcuMjgtMy41ODN2LTEuNDZjMS4xNTYtLjg0NSAyLjIzLTIuMjUgMi4zMDItMy4xNjggMS4zMDctLjYzNCAxLjU4LTIuMjEzLjY1LTIuNTYybC0uMDIuMDNjLjQyLS41ODcuNjc3LTEuMzM1LjY3Ny0yLjE5MiAwLTEuMTEtLjItMi4xMzYtMS4wMTctMi44MDYtLjU2Ny0xLjM0LTEuNzQ2LTIuMjY2LTMuMTE2LTIuMjY2LS44MDQgMC0xLjU0LjMyLTIuMTMuODU0YTEuMjIzIDEuMjIzIDAgMCAwLS43ODctLjI5N2MtLjUxNCAwLS45Ni4zNDUtMS4yLjg1Mi0xLjI5NC40NzgtMi4yMzYgMS45MzYtMi4yMzYgMy42NjMgMCAuNzkuMTk4IDEuNTI2LjUzNiAyLjEzNi0xIC4zOTQtLjY2NiAxLjkuNTk1IDIuNTkuMDc0LjkxNSAxLjE0NyAyLjMyMiAyLjMwMiAzLjE2NnYxLjQ1N0ExMi43MjUgMTIuNzI1IDAgMCAwIDMgMjF6JyxcbiAgICAgIHBhdGg6ICd1c2VyX2RldGFpbHMnXG4gICAgfSxcbiAgICBMT0dHRURfVVNFUl9NRU5VX1JFVklFV1M6IHtcbiAgICAgIHRhZzogJ3JldmlldycsXG4gICAgICB0aXRsZTogJ1Jldmlld3MnLFxuICAgICAgc3ZnOlxuICAgICAgICAnTTIxIDZhMyAzIDAgMCAwLTMtM0g2YTMgMyAwIDAgMC0zIDN2MTJhMyAzIDAgMCAwIDMgM2gxMmEzIDMgMCAwIDAgMy0zVjZ6bS01Ljg4IDEwLjQyOGwtMy4xNi0xLjkzOC0zLjA1IDIuMDEuNTktMy40NTdMNyAxMC41OTZsMy40NTctLjUwNUwxMS45NiA2LjVsMS41ODIgMy41OSAzLjQ1OC41MDYtMi41IDIuNDQ3LjYyIDMuMzg1eicsXG4gICAgICBwYXRoOiAndXNlcl9kZXRhaWxzX3Jldmlld3Nfc2VsZidcbiAgICB9LFxuICAgIExPR0dFRF9VU0VSX01FTlVfQlJPV1NFUl9QSE9UT1M6IHtcbiAgICAgIHRhZzogJ2NhbWVyYScsXG4gICAgICB0aXRsZTogJ0Jyb3dzZXIgUGhvdG9zJyxcbiAgICAgIHN2ZzpcbiAgICAgICAgJ00xOSAyMEg1YTMgMyAwIDAgMS0zLTNWOWEzIDMgMCAwIDEgMy0zaDIuMTg0QTIuOTkgMi45OSAwIDAgMSAxMCA0aDRhMi45OSAyLjk5IDAgMCAxIDIuODE2IDJIMTlhMyAzIDAgMCAxIDMgM3Y4YTMgMyAwIDAgMS0zIDN6TTEyLjAwNSA4LjVhNC41IDQuNSAwIDEgMCAwIDkgNC41IDQuNSAwIDAgMCAwLTl6bTAgN2EyLjUgMi41IDAgMSAxIDAtNSAyLjUgMi41IDAgMCAxIDAgNXonLFxuICAgICAgcGF0aDogJ3VzZXJfbG9jYWxfcGhvdG9zJ1xuICAgIH0sXG4gICAgTE9HR0VEX1VTRVJfTUVOVV9FVkVOVFM6IHtcbiAgICAgIHRhZzogJ2V2ZW50JyxcbiAgICAgIHRpdGxlOiAnRXZlbnRzJyxcbiAgICAgIHN2ZzpcbiAgICAgICAgJ00xOCAyMUg2YTMgMyAwIDAgMS0zLTNWNmEzIDMgMCAwIDEgMy0zIDEgMSAwIDAgMSAyIDBoOGExIDEgMCAwIDEgMiAwIDMgMyAwIDAgMSAzIDN2MTJhMyAzIDAgMCAxLTMgM3ptMS0xM0g1djEwYzAgLjU1LjQ1IDEgMSAxaDEyYy41NSAwIDEtLjQ1IDEtMVY4em0tNS42MzQgNy43MjNMMTIgMThsLTEuMzY2LTIuMjc3YTMuNSAzLjUgMCAxIDEgMi43MzIgMHpNMTIgMTEuMjVhMS4yNSAxLjI1IDAgMSAwIDAgMi41IDEuMjUgMS4yNSAwIDAgMCAwLTIuNXonLFxuICAgICAgcGF0aDogJ3VzZXJfZGV0YWlsc19ldmVudHMnXG4gICAgfSxcbiAgICBMT0dHRURfVVNFUl9NRU5VX1JFQ0lQRVM6IHtcbiAgICAgIHRhZzogJ3JlY2lwZScsXG4gICAgICB0aXRsZTogJ1JlY2lwZXMnLFxuICAgICAgc3ZnOlxuICAgICAgICAnTTE3LjIyIDIyYTEuNzggMS43OCAwIDAgMS0xLjc0LTIuMTY3bDEuMjk4LTQuOThMMTQgMTNsMS43NTYtOS42NTdBMS42MzUgMS42MzUgMCAwIDEgMTkgMy42MzVWMjAuMjJBMS43OCAxLjc4IDAgMCAxIDE3LjIyIDIyem0tNy4xMzgtOS4xNTZsLjY5NyA3LjE2OGExLjc5IDEuNzkgMCAxIDEtMy41NiAwbC43LTcuMTc4QTMuOTg1IDMuOTg1IDAgMCAxIDUgOVYzYTEgMSAwIDAgMSAyIDB2NS41YzAgLjI4LjIyLjUuNS41cy41LS4yMi41LS41VjNhMSAxIDAgMCAxIDIgMHY1LjVjMCAuMjguMjIuNS41LjVzLjUtLjIyLjUtLjVWM2ExIDEgMCAwIDEgMiAwdjUuODNjMCAxLjg1LTEuMiAzLjUxOC0yLjkxOCA0LjAxNHonLFxuICAgICAgcGF0aDogJ3VzZXJfZGV0YWlsc19yZWNpcGVzJ1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBpc0xvZ2dlZFVzZXIodXNlclByb2ZpbGUsIGN1cnJlbnRVc2VyKSB7XG4gICAgaWYgKCEhY3VycmVudFVzZXIgJiYgISF1c2VyUHJvZmlsZSAmJiB1c2VyUHJvZmlsZS5pZCA9PT0gY3VycmVudFVzZXIuaWQpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgLyoqXG4gICAqIEBzdW1tYXJ5IEdldCBhIHVzZXIncyBlbWFpbCBoYXNoXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyXG4gICAqL1xuICBzdGF0aWMgZ2V0RW1haWxIYXNoKHVzZXI6IElQYXJzZU1vZGVsVXNlcnMpIHtcbiAgICByZXR1cm4gTWQ1VXRpbHMuZ2V0TWQ1U3RyaW5nKHVzZXIuZW1haWwpXG4gIH1cblxuICBzdGF0aWMgZ2V0Q3JlYXRlZEF0Rm9ybWF0KHVzZXIpIHtcbiAgICByZXR1cm4gTW9tZW50VXRpbHMudG9EYXRlU3RyaW5nKHVzZXIuY3JlYXRlZEF0LCBVc2Vycy5jb25maWcuZGF0ZUZvcm1hdClcbiAgfVxuXG4gIHN0YXRpYyBnZXRPcmRlcmVkVXNlckZvcm1hdChwZW9wbGVJbkV2ZW50KSB7XG4gICAgcmV0dXJuIE1vbWVudFV0aWxzLnRvRGF0ZVN0cmluZyhwZW9wbGVJbkV2ZW50LmNyZWF0ZWRBdCwgVXNlcnMuY29uZmlnLm9yZGVyZWREYXRhRm9ybWF0KVxuICB9XG5cbiAgc3RhdGljIGdldEludml0ZUVtYWlsT2JqZWN0KHByb3BzKSB7XG4gICAgY29uc3QgeyBhdXRoIH0gPSBwcm9wc1xuICAgIGxldCBzaXplID0gMFxuICAgIGNvbnN0IGVtYWlsczogYW55ID0ge1xuICAgICAgMDogJycsXG4gICAgICAxOiAnJyxcbiAgICAgIDI6ICcnXG4gICAgfVxuICAgIGNvbnN0IGVtYWlsID0gYXV0aC5mb3JtLmZpZWxkcy5lbWFpbFxuICAgIGlmIChlbWFpbCAhPT0gJycpIHtcbiAgICAgIHNpemUrK1xuICAgICAgZW1haWxzWzBdID0gZW1haWxcbiAgICB9XG4gICAgY29uc3QgZW1haWwxID0gYXV0aC5mb3JtLmZpZWxkcy5lbWFpbDFcbiAgICBpZiAoZW1haWwxICE9PSAnJykge1xuICAgICAgc2l6ZSsrXG4gICAgICBlbWFpbHNbMV0gPSBlbWFpbDFcbiAgICB9XG4gICAgY29uc3QgZW1haWwyID0gYXV0aC5mb3JtLmZpZWxkcy5lbWFpbDJcbiAgICBpZiAoZW1haWwyICE9PSAnJykge1xuICAgICAgc2l6ZSsrXG4gICAgICBlbWFpbHNbMl0gPSBlbWFpbDJcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHNpemUsXG4gICAgICBlbWFpbHNcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZ2V0U2VsZWN0ZWRVc2VySW5kZXgobmV3TGlzdFRhc2ssIHNlbGVjdGVkUGhvdG9JbmZvKSB7XG4gICAgY29uc3QgeyByZXN1bHRzIH0gPSBuZXdMaXN0VGFza1xuICAgIGNvbnN0IHsgdXNlcklkIH0gPSBzZWxlY3RlZFBob3RvSW5mb1xuICAgIGxldCBzZWxlY3RlZFVzZXJJbmRleCA9IFVuZGVyc2NvcmVVdGlscy5maW5kSW5kZXhJbkFycmF5KHtcbiAgICAgIGFycmF5OiByZXN1bHRzLFxuICAgICAgcHJlZGljYXRlOiAoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIHJldHVybiBpdGVtLmlkID09PSB1c2VySWRcbiAgICAgIH1cbiAgICB9KVxuICAgIGlmIChzZWxlY3RlZFVzZXJJbmRleCA9PT0gLTEpIHtcbiAgICAgIHNlbGVjdGVkVXNlckluZGV4ID0gMFxuICAgIH1cbiAgICBjb25zdCBzZWxlY3RlZFVzZXJJZCA9IHJlc3VsdHMubGVuZ3RoID4gMCA/IHJlc3VsdHNbc2VsZWN0ZWRVc2VySW5kZXhdLmlkIDogbnVsbFxuICAgIHJldHVybiB7XG4gICAgICBzZWxlY3RlZFVzZXJJbmRleCxcbiAgICAgIHNlbGVjdGVkVXNlcklkXG4gICAgfVxuICB9XG59XG4iXX0=